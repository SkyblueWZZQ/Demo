# 第六步：支持es6新特性

### 背景
- 因为es6发布较晚，各大浏览器还没完全支持es6语法以及其特性，现阶段开发者大多采用[babel](http://babeljs.io/docs/en)进行代码语法转换
    >Babel has support for the latest version of JavaScript through syntax transformers. These plugins allow you to use new syntax, right now without waiting for browser support. 
    Babel通过语法变换器支持最新版本的JavaScript。 这些插件允许您立即使用新语法，而无需等待浏览器支持。
- 但是 babel 只是转换语法，并不能转换新特性，如箭头函数以及一些新的方法拓展
    >Since Babel only transforms syntax (like arrow functions), you can use babel-polyfill in order to support new globals such as Promise or new native methods like String.padStart (left-pad). It uses core-js and regenerator. 
    由于Babel只转换语法（如箭头函数），因此您可以使用babel-polyfill来支持新的全局变量（如Promise）或新的本机方法（如String.padStart（left-pad））。 它使用core-js和regenerator
#### Polyfill
- 

#### 像使用 css modules 一样使用less
- 先说一下 css modules
    - 使用方式：  
      ![image.png](https://upload-images.jianshu.io/upload_images/3504920-449d8297d6675e08.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)  
    - 编译结果：  
      ![image.png](https://upload-images.jianshu.io/upload_images/3504920-74dcb92dab730d9b.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)

    - webpack配置：  
    ```
        {
            test: /\.css$/,
            loader: 'style-loader!css-loader?{"modules":true}'
        },
    ```  
- 使用 less
    - 正常使用姿势：  
    ![image.png](https://upload-images.jianshu.io/upload_images/3504920-48083a61dc2fc3ae.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)  
      - 问题：  
        ![image.png](https://upload-images.jianshu.io/upload_images/3504920-e7878eb104214aa5.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)  
      文件结构：  
      ![index.js](https://upload-images.jianshu.io/upload_images/3504920-741b82527a08949e.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)  
不难发现，List 和 Detail 组件都引用了自己模块的 less文件，而且两个 less 文件的类名都是  container，但是样式不同，最后打包在一起，导致重名类样式被覆盖。如何解决呢？根据 css modules 的输出结果我们可以得到启示，可以借助 css modules 来实现生成不同的类名。
   - modules 使用方式：  
   ![image.png](https://upload-images.jianshu.io/upload_images/3504920-f4b35070cb746199.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)
   - 输出结果：  
    ![image.png](https://upload-images.jianshu.io/upload_images/3504920-b1688373796d7007.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)
    完美的解决了重名样式被覆盖的问题！
   - webpack 配置  
    ```
    {
        test: /\.less$/,
        use: ExtractTextWebpackPlugin.extract({
            fallback: 'style-loader',
            use: [
                {
                    loader: 'css-loader',
                    options: {
                        modules: true,
                        localIdentName: '[name]_[local]-[hash:base64:5]'
                    }
                },
                {
                    loader: 'less-loader'
                }
            ]
        })
    }
    ```  

  - 实现思路：所有的样式文件最终都会转换成 css 代码，都需要使用 css-loader ，所以就可以借助 css-loader 的 modules 配置实现 less 的 modules 用法。
  - 存在的问题：公共样式也使用的 less ，这样的配置岂不是把公共样式的类名也改变了，导致业务无法使用公共样式。
    - 解决思路：
        - 1、业务样式文件和公共样式文件使用不同的命名，然后在 为 loader 匹配文件时，做不同的处理。
        - 2、 使用 include 和 exclude 配置项对公共样式文件区分，以实现 公共样式 less 类名不处理